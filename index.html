<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refugee Acceptance Study</title>
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/dist/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine, Cell } = Recharts;

        const calculateCI = (estimate, se) => [estimate - 1.96 * se, estimate + 1.96 * se];

        const rawData = {
            gender: [
                { level: 'Male', baseline: true },
                { level: 'Female', neighbor: 0.033, neighborSE: 0.005, workPermit: 0.023, workPermitSE: 0.005, citizenship: 0.020, citizenshipSE: 0.005 }
            ],
            age: [
                { level: 'Middle-aged', baseline: true },
                { level: 'Young', neighbor: 0.006, neighborSE: 0.007, workPermit: 0.004, workPermitSE: 0.007, citizenship: 0.002, citizenshipSE: 0.006 },
                { level: 'Old', neighbor: 0.004, neighborSE: 0.007, workPermit: -0.003, workPermitSE: 0.007, citizenship: 0.003, citizenshipSE: 0.007 }
            ],
            ethnicity: [
                { level: 'Turkmen', baseline: true },
                { level: 'Arab', neighbor: -0.064, neighborSE: 0.007, workPermit: -0.064, workPermitSE: 0.007, citizenship: -0.058, citizenshipSE: 0.006 },
                { level: 'Kurd', neighbor: -0.069, neighborSE: 0.007, workPermit: -0.067, workPermitSE: 0.007, citizenship: -0.056, citizenshipSE: 0.006 }
            ],
            religion: [
                { level: 'Sunni', baseline: true },
                { level: 'Alawite', neighbor: -0.009, neighborSE: 0.007, workPermit: -0.003, workPermitSE: 0.007, citizenship: -0.006, citizenshipSE: 0.006 },
                { level: 'Christian', neighbor: -0.041, neighborSE: 0.007, workPermit: -0.034, workPermitSE: 0.007, citizenship: -0.034, citizenshipSE: 0.007 }
            ],
            education: [
                { level: 'No education', baseline: true },
                { level: 'Primary school', neighbor: -0.015, neighborSE: 0.009, workPermit: 0.002, workPermitSE: 0.009, citizenship: -0.005, citizenshipSE: 0.009 },
                { level: 'Middle school', neighbor: 0.0003, neighborSE: 0.009, workPermit: 0.011, workPermitSE: 0.009, citizenship: 0.009, citizenshipSE: 0.008 },
                { level: 'High school', neighbor: 0.006, neighborSE: 0.008, workPermit: 0.028, workPermitSE: 0.009, citizenship: 0.028, citizenshipSE: 0.008 },
                { level: 'University', neighbor: 0.030, neighborSE: 0.009, workPermit: 0.053, workPermitSE: 0.009, citizenship: 0.038, citizenshipSE: 0.008 }
            ],
            localFriends: [
                { level: 'No Turkish friends', baseline: true },
                { level: 'Has Turkish friends', neighbor: 0.018, neighborSE: 0.005, workPermit: 0.011, workPermitSE: 0.005, citizenship: 0.011, citizenshipSE: 0.005 }
            ],
            turkish: [
                { level: 'Does not know Turkish', baseline: true },
                { level: 'Knows Turkish', neighbor: 0.039, neighborSE: 0.005, workPermit: 0.030, workPermitSE: 0.005, citizenship: 0.018, citizenshipSE: 0.005 }
            ],
            foughtInWar: [
                { level: 'Did not fight', baseline: true },
                { level: 'Fought with Assad', neighbor: -0.065, neighborSE: 0.007, workPermit: -0.069, workPermitSE: 0.007, citizenship: -0.045, citizenshipSE: 0.007 },
                { level: 'Fought with FSA', neighbor: 0.015, neighborSE: 0.007, workPermit: 0.020, workPermitSE: 0.007, citizenship: 0.020, citizenshipSE: 0.007 }
            ],
            torture: [
                { level: 'Not tortured', baseline: true },
                { level: 'Tortured in Syria', neighbor: 0.011, neighborSE: 0.005, workPermit: 0.019, workPermitSE: 0.005, citizenship: 0.008, citizenshipSE: 0.005 }
            ]
        };

        const processedData = {};
        Object.keys(rawData).forEach(attr => {
            processedData[attr] = rawData[attr].map(item => {
                if (item.baseline) {
                    return { level: item.level, neighbor: 0, workPermit: 0, citizenship: 0, neighborCI: [0,0], workPermitCI: [0,0], citizenshipCI: [0,0], isBaseline: true };
                }
                return {
                    level: item.level,
                    neighbor: item.neighbor,
                    workPermit: item.workPermit,
                    citizenship: item.citizenship,
                    neighborCI: calculateCI(item.neighbor, item.neighborSE),
                    workPermitCI: calculateCI(item.workPermit, item.workPermitSE),
                    citizenshipCI: calculateCI(item.citizenship, item.citizenshipSE),
                    isBaseline: false
                };
            });
        });

        function App() {
            const [outcome, setOutcome] = useState('neighbor');
            const [attribute, setAttribute] = useState('torture');
            const [showCI, setShowCI] = useState(true);
            const [compare, setCompare] = useState(false);

            const labels = {
                gender: 'Gender', age: 'Age', ethnicity: 'Ethnicity', religion: 'Religion',
                education: 'Education Level', localFriends: 'Local Connections',
                turkish: 'Turkish Language', foughtInWar: 'Conflict Involvement',
                torture: 'Torture Experience'
            };

            const outcomes = {
                neighbor: 'Accept as Neighbor',
                workPermit: 'Support Work Permit',
                citizenship: 'Support Citizenship'
            };

            const baseline = processedData[attribute].find(i => i.isBaseline)?.level || '';
            const chartData = processedData[attribute].filter(i => !i.isBaseline);

            const data = compare
                ? chartData.map(i => ({ level: i.level, 'Accept as Neighbor': i.neighbor, 'Work Permit': i.workPermit, 'Citizenship': i.citizenship }))
                : chartData.map(i => ({ level: i.level, effect: i[outcome], ciLower: i[`${outcome}CI`][0], ciUpper: i[`${outcome}CI`][1] }));

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Humanitarian Concerns and Syrian Refugee Acceptance</h1>
                            <p className="text-gray-600">Interactive visualization of conjoint experiment results from Turkey</p>
                            <p className="text-sm text-gray-500 mt-2">Anna Getmansky, Konstantinos Matakos, and Tolga Sinmazdemir</p>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Select Refugee Attribute</label>
                                    <select value={attribute} onChange={e => setAttribute(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg bg-white">
                                        {Object.entries(labels).map(([k, v]) => <option key={k} value={k}>{v}</option>)}
                                    </select>
                                </div>
                                {!compare && (
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Select Outcome</label>
                                        <select value={outcome} onChange={e => setOutcome(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg bg-white">
                                            {Object.entries(outcomes).map(([k, v]) => <option key={k} value={k}>{v}</option>)}
                                        </select>
                                    </div>
                                )}
                            </div>
                            <div className="flex gap-4 mt-6">
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={compare} onChange={e => setCompare(e.target.checked)} />
                                    <span className="text-sm font-medium">Compare all outcomes</span>
                                </label>
                                {!compare && (
                                    <label className="flex items-center gap-2">
                                        <input type="checkbox" checked={showCI} onChange={e => setShowCI(e.target.checked)} />
                                        <span className="text-sm font-medium">Show confidence intervals</span>
                                    </label>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">
                                {compare
                                    ? `Effect of ${labels[attribute]} on All Outcomes (baseline: ${baseline})`
                                    : `Effect of ${labels[attribute]} on ${outcomes[outcome]} (baseline: ${baseline})`}
                            </h2>

                            <ResponsiveContainer width="100%" height={400}>
                                <BarChart data={data} margin={{ top: 20, right: 30, left: 40, bottom: 60 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="level" angle={-45} textAnchor="end" height={80} interval={0} />
                                    <YAxis label={{ value: 'Effect (percentage points)', angle: -90, position: 'insideLeft' }}
                                        domain={[-0.1, 0.1]} ticks={[-0.1, -0.05, 0, 0.05, 0.1]}
                                        tickFormatter={v => (v * 100).toFixed(0)} />
                                    <Tooltip />
                                    <ReferenceLine y={0} stroke="#666" strokeWidth={2} />
                                    {compare ? (
                                        <>
                                            <Legend />
                                            <Bar dataKey="Accept as Neighbor" fill="#3b82f6" />
                                            <Bar dataKey="Work Permit" fill="#10b981" />
                                            <Bar dataKey="Citizenship" fill="#8b5cf6" />
                                        </>
                                    ) : (
                                        <Bar dataKey="effect">
                                            {data.map((e, i) => <Cell key={i} fill={e.effect > 0 ? '#10b981' : '#ef4444'} />)}
                                        </Bar>
                                    )}
                                </BarChart>
                            </ResponsiveContainer>

                            <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h3 className="font-semibold text-gray-800 mb-2">How to read this chart:</h3>
                                <ul className="text-sm text-gray-700 space-y-1">
                                    <li>• Baseline (reference) category is shown in the title with effect of 0</li>
                                    <li>• <span className="font-semibold text-green-600">Green bars</span> = Positive effect</li>
                                    <li>• <span className="font-semibold text-red-600">Red bars</span> = Negative effect</li>
                                    <li>• Values in percentage points (0.05 = 5pp increase)</li>
                                </ul>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mt-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Key Findings</h2>
                            <div className="text-gray-700 space-y-3">
                                <p><strong>Torture information matters:</strong> Increases neighbor acceptance by 1.1pp and work permit support by 1.9pp.</p>
                                <p><strong>Language is crucial:</strong> Knowing Turkish increases neighbor acceptance by 3.9pp and work permit support by 3.0pp.</p>
                                <p><strong>Education matters:</strong> University education increases work permit support by 5.3pp.</p>
                                <p><strong>Ethnicity matters:</strong> Arab and Kurdish refugees face 6-7pp penalties vs Turkmen.</p>
                                <p><strong>Fighting for Assad penalized:</strong> 6.5-6.9pp penalty; FSA fighters get 1.5-2.0pp boost.</p>
                                <p className="text-sm text-gray-600 italic mt-4">Note: Effects relative to baseline categories with respondent fixed effects.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
